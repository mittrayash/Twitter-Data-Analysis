<!DOCTYPE html>
<html>
    <head>
        <title>Yash Mittra - Precog Task</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
        <script type='text/javascript' src='https://www.gstatic.com/charts/loader.js'></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
        <script type='text/javascript'>

            google.charts.load('current', {
                'packages': ['geochart'],
                'mapsApiKey': 'AIzaSyDmhqzsOEIbcWwnNLwbGIyWyn6iw6mRgg4'
            });            
            google.charts.load("current", {packages:["corechart"]});

            google.charts.setOnLoadCallback(drawColumnChart2);
            function drawColumnChart2() {

                var data8 = google.visualization.arrayToDataTable([
                    ["Outlier Type", "Value", { role: "style" } ],
                    {% for x in outliers_count %}
                    ["{{ x["tag"] }}", {{ x["value"] }}, "black"],
                    {% endfor %}
                ]);

                var options = {
                    width: 600,
                    height: 450,
                    bar: {groupWidth: "60%"},
                    legend: { position: "none" },
                };

                var chart = new google.visualization.ColumnChart(document.getElementById('columnchart_values2'));
                chart.draw(data8, options);
            }

            google.charts.setOnLoadCallback(drawMarkersMap);
            function drawMarkersMap() {
                var data1 = google.visualization.arrayToDataTable([
                    ['City', 'Tweets'],
                    {% for loc in location_count %}
                    ["{{ loc["city"] }}", {{ loc["tweets"] }}],
                    {% endfor %}
                ]);
                var options = {
                    region: 'IN',
                    displayMode: 'markers',
                    colorAxis: {colors: ['grey', 'black']}
                };
                var chart = new google.visualization.GeoChart(document.getElementById('chart_div'));
                chart.draw(data1, options);
            };
            google.charts.setOnLoadCallback(drawDonutChart);
            function drawDonutChart() {
            var data2 = google.visualization.arrayToDataTable([
                ['Category', 'Hits'],
                ['Original Tweets', {{ orig_retweets[0] }}],
                ['Retweets', {{ orig_retweets[1] }}]
            ]);

            var options = {
                pieHole: 0.2,
                slices: {
                    0: {color: 'black'},
                    1: {color: 'grey'}
                }
            };

            var chart = new google.visualization.PieChart(document.getElementById('donutchart'));
                chart.draw(data2, options);
            }
            google.charts.setOnLoadCallback(drawBarChart);
            function drawBarChart() {
                var data3 = google.visualization.arrayToDataTable([
                    ["Type of Tweet", "Hits", { role: "style" } ],
                    ["Text", {{ media_count[0] }}, "black"],
                    ["Images", {{ media_count[1] }}, "black"],
                    ["Text + Images", {{ media_count[2] }}, "black"]
                ]);

                var options = {
                    width: 600,
                    height: 450,
                    bar: {groupWidth: "95%"},
                    legend: { position: "none" },
                };
                var chart = new google.visualization.BarChart(document.getElementById("barchart_values"));
                chart.draw(data3, options);
            }

            google.charts.setOnLoadCallback(drawColumnChart);
            function drawColumnChart() {
                var data4 = google.visualization.arrayToDataTable([
                    ["Favorite Count", "Tweets", { role: "style" } ],
                    {% for fv in favorite_count %}
                    [">{{ fv["favs"] }}", {{ fv["count"] }}, "black"],
                    {% endfor %}
                ]);

                var options = {
                    width: 600,
                    height: 450,
                    bar: {groupWidth: "95%"},
                    legend: { position: "none" },
                };

                var chart = new google.visualization.ColumnChart(document.getElementById('columnchart_values'));
                chart.draw(data4, options);
            }
        </script>
    <style rel="stylesheet">

path.country {
    fill: gray;
    stroke-width: 1;
    stroke: black;
    opacity: .5;
}
path.sample {
    stroke: black;
    stroke-width: 1px;
    fill: red;
    fill-opacity: .5;
}
line.link {
      stroke-width: 1px;
      stroke: black;
      stroke-opacity: .5;
}
circle.node {
  fill: red;
  stroke: white;
  stroke-width: 1px;
}
circle.xy {
  fill: pink;
  stroke: black;
  stroke-width: 1px;
}
    </style>


    </head>
    <body  style="font-family: 'Montserrat', sans-serif;">
        <div class="container-fluid">
            <div class="jumbotron" style="background-color: darkslategray; color: #fff;">

                <h1 style="text-align:center"><b>Twitter Data Analysis</b></h1>
            </div>

            <canvas height="500" width="500"></canvas>
            <div id="viz">
              <svg  height="500" width="500"></svg>
            </div>
            <div class="row" style="margin-top:40px">
            <div class='col-xs-12 col-sm-6' id="columnchart_values2" ></div>
            <div class="col-xs-12 col-sm-6">
            <h1 style="padding-top: 50px; text-align:center"><b>Outliers</b></h1>
            <p style="text-align:center; font-size:20px">This graph evaluates the activity of non-Delhi people who are talking about Pollution and non-Mumbai People who are talking about rains.</p>
            </div>
            </div>
            <div class="row">
                <div class="col-md-7">
                    <div id="chart_div" style="width:800px; height:500px; border: 2px solid black"></div>
                </div>
                <div class="col-md-5">
                    <br>
                    <br>
                    <h1 style="text-align:center"><b>Location of Tweets</b></h1>
                    <p style="text-align:justify; font-size:20px; padding-left: 10%"><br><br>
                        According to the locations, tweets have been marked on the map. <br>
                        However, if Google is unable to identify their origin, they are taken as India.
                    </p>
                </div>
            </div>
            <div class="row" style="margin-top:100px">
                <div class="col-md-5" style="padding-right: 10%">
                    <br>
                    <br>
                    <h1 style="text-align:center"><b>Top 10 Hashtags in DataSet</b></h1>
                    <p style="text-align:center; font-size:20px"><br><br>
                       The top 10 Hashtags in the curated dataset have been listed here.
                    </p>
                </div>
                <div class="col-md-7">
                    <table class="table table-bordered table-striped" align="right" style="width:800px; height:400px; border: 2px solid black; text-align:center">
                        <thead style="background-color:black; color:white">
                            <td width="200px"><b>Rank</b></td>
                            <td width="400px"><b>Hashtag</b></td>
                            <td width="200px"><b>Occurrences</b></td>
                        </thead>
                            {% for hash in hashtag_count %}
                            <tr>
                                <td>#{{ hash["index"] }}</td>
                                <td>{{ hash["hashtag"] }}</td>
                                <td>{{ hash["count"] }}</td>
                            </tr>
                            {% endfor %}
                    </table>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12 col-md-7">
                    <div id="donutchart" style="width: 900px; height: 600px;"></div>
                </div>
                <div class="col-md-5">
                    <br><br><br><br><br><br><br>
                    <h2 style="text-align:center"><b>Original Tweets vs Retweets</b></h2>
                    <p style="text-align:center; font-size:20px"><br><br>
                        This donut chart imparts information about the population of Original Tweets vs the population of Retweets in the curated dataset.
                    </p>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <h2 style="text-align:center"><b>Favorite Count in Original Tweets</b></h2>
                <div id="columnchart_values" style="width: 900px; height: 500px;"></div>
                </div>
                <div class="col-md-6">
                    <h2 style="text-align:center"><b>Distribution of Tweets (Text vs Image)</b></h2>
                    <div id="barchart_values" style="width: 900px; height: 500px;"></div>
                </div>
            </div>
        </div>

    <script>
  var linkScale = d3.scale.linear().domain([0,.9,.95,1]).range([0,10,100,1000]);

  sampleNodes = d3.range(3000).map(function(d) {
    var datapoint = {};
    datapoint.id = "Sample Node " + d;
    //console.log(datapoint);
    return datapoint;
  })
  k={};
  {% for x in nodes %}
      [console.log(x)],
  {% endfor %}

  console.log(k);



  sampleLinks = [];
    var y = 0;
    while (y < 1000) {
      var randomSource = Math.floor(Math.random() * 1000);
      var randomTarget = Math.floor(linkScale(Math.random()));
      var linkObject = {source: sampleNodes[randomSource], target: sampleNodes[randomTarget]}
      if (randomSource != randomTarget) {
       sampleLinks.push(linkObject);
      }
      y++;
  }

      force = d3.layout.force()
      .size([500,500])
      .gravity(.5)
      .nodes(sampleNodes)
      .links(sampleLinks)
      .on("tick", forceTick);

      d3.select("svg").selectAll("circle.node")
      .data(sampleNodes)
      .enter()
      .append("circle")
      .attr("r", 3)
      .style("fill", "red")
      .attr("class", "node")
      .style("stroke", "white")
      .style("stroke-width", "1px");

      force.start();

      function forceTick() {
      	var context = d3.select("canvas").node().getContext("2d");
        context.clearRect(0,0,500,500);

        context.lineWidth = 1;
        context.strokeStyle = "rgba(0, 0, 0, 0.5)";

      sampleLinks.forEach(function (link) {
        context.beginPath();
        context.moveTo(link.source.x,link.source.y)
        context.lineTo(link.target.x,link.target.y)
        context.stroke();
      })

        d3.selectAll("circle.node")
        .attr("cx", function(d) {return d.x})
        .attr("cy", function(d) {return d.y});
      }


</script>

<footer style="color: #fff; background-color: darkslategray;"><center>
    Made by <a href="https://mittrayash.github.io/"><b>&nbsp;Yash Mittra</b></a>
</center></footer>
    </body>
</html>
